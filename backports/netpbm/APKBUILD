# Contributor: Atsushi Watanabe <atsushi.w@ieee.org>
# Maintainer:
pkgname=netpbm
pkgver=10.77.04
pkgrel=0
pkgdesc="Netpbm - graphics tools and converters"
url="https://sourceforge.net/projects/netpbm/"
arch="all"
options="!check"	# The test fails due to external library's problem on modern environment.
									# And, this library highly depends on the directory structure. It needs large changes to enable the test.
license="netpbm"
depends=""
makedepends="patchutils perl libjpeg-turbo-dev libpng-dev tiff-dev zlib-dev libx11-dev libxml2-dev"
subpackages="lib$pkgname:lib lib$pkgname-dev:lib_dev $pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/chneukirchen/netpbm-mirror/archive/$pkgver.tar.gz
	add-config.patch"

builddir="$srcdir/netpbm-mirror-$pkgver"

build() {
	cd "$builddir"

	make
	make package
}

package() {
	cd "$builddir"

	install -d -m 0755 "$pkgdir"/usr/bin
	install -m 0644 /tmp/netpbm/bin/* "$pkgdir"/usr/bin

	install -d -m 0755 "$pkgdir"/usr/share/licenses/netpbm
	install -m 0644 "$builddir"/doc/copyright_summary "$pkgdir"/usr/share/licenses/netpbm
	install -m 0644 "$builddir"/doc/COPYRIGHT.PATENT "$pkgdir"/usr/share/licenses/netpbm
	install -m 0644 "$builddir"/doc/GPL_LICENSE.txt "$pkgdir"/usr/share/licenses/netpbm
	install -m 0644 "$builddir"/doc/patent_summary "$pkgdir"/usr/share/licenses/netpbm
}

lib() {
	cd "$builddir"

	install -d -m 0755 "$subpkgdir"/usr/lib
	install -m 0644 /tmp/netpbm/lib/* "$subpkgdir"/usr/lib
}

lib_dev() {
	cd "$builddir"

	install -d -m 0755 "$subpkgdir"/usr/include/netpbm
	install -m 0644 /tmp/netpbm/include/netpbm/* "$subpkgdir"/usr/include/netpbm
}
