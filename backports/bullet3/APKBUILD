# Contributor: Atsushi Watanabe <atsushi.w@ieee.org>
# Maintainer:
pkgname=bullet3
pkgver=2.88
pkgrel=0
pkgdesc="Real-time collision detection and multi-physics simulation for VR, games, visual effects, robotics, machine learning etc."
url="http://bulletphysics.org/"
arch="all"
options="!check"	# the test deeply depends on the examples using embedded pre-built binaries which are incompatible with alpine
license="zlib"
makedepends="cmake linux-headers"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/bulletphysics/$pkgname/archive/$pkgver.tar.gz"

build() {
	cd "$builddir"
	cmake \
		-DUSE_DOUBLE_PRECISION=ON \
		-DUSE_GRAPHICAL_BENCHMARK=OFF \
		-DBUILD_CPU_DEMOS=OFF \
		-DBUILD_OPENGL3_DEMOS=OFF \
		-DBUILD_BULLET2_DEMOS=OFF \
		-DBUILD_UNIT_TESTS=OFF \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_CXX_FLAGS="$CXXFLAGS" \
		-DCMAKE_C_FLAGS="$CFLAGS"
	make -j
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}
